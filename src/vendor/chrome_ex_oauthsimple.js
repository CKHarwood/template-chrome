/**
 * OAuthSimple 1.0
 * A simpler version of OAuth
 * http://unitedHeroes.net/OAuthSimple
 *
 * Copyright 2009, jr conlin <src@anticipatr.com> (unitedHeroes.net)
 * All rights reserved
 */
var OAuthSimple;if(OAuthSimple===undefined){OAuthSimple=function(a,b){this._secrets={};this._parameters={};if(a!==undefined){this._secrets["consumer_key"]=a}if(b!==undefined){this._secrets["shared_secret"]=b}this._default_signature_method="HMAC-SHA1";this._action="GET";this._nonce_chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";this.reset=function(){this._parameters={};this._path=undefined;return this};this.setParameters=function(a){if(a===undefined){a={}}if(typeof a=="string"){a=this._parseParameterString(a)}this._parameters=a;if(this._parameters["oauth_nonce"]===undefined){this._getNonce()}if(this._parameters["oauth_timestamp"]===undefined){this._getTimestamp()}if(this._parameters["oauth_method"]===undefined){this.setSignatureMethod()}if(this._parameters["oauth_consumer_key"]===undefined){this._getApiKey()}if(this._parameters["oauth_token"]===undefined){this._getAccessToken()}return this};this.setQueryString=function(a){return this.setParameters(a)};this.setURL=function(a){if(a==""){throw"No path specified for OAuthSimple.setURL"}this._path=a;return this};this.setPath=function(a){return this.setURL(a)};this.setAction=function(a){if(a===undefined){a="GET"}a=a.toUpperCase();if(a.match("[^A-Z]")){throw"Invalid action specified for OAuthSimple.setAction"}this._action=a;return this};this.setTokensAndSecrets=function(a){if(a){for(var b in a){this._secrets[b]=a[b]}}if(this._secrets["api_key"]){this._secrets.consumer_key=this._secrets.api_key}if(this._secrets["access_token"]){this._secrets.oauth_token=this._secrets.access_token}if(this._secrets["access_secret"]){this._secrets.oauth_secret=this._secrets.access_secret}if(this._secrets.consumer_key===undefined){throw"Missing required consumer_key in OAuthSimple.setTokensAndSecrets"}if(this._secrets.shared_secret===undefined){throw"Missing required shared_secret in OAuthSimple.setTokensAndSecrets"}if(this._secrets.oauth_token!==undefined&&this._secrets.oauth_secret===undefined){throw"Missing oauth_secret for supplied oauth_token in OAuthSimple.setTokensAndSecrets"}return this};this.setSignatureMethod=function(a){if(a===undefined){a=this._default_signature_method}if(a.toUpperCase().match(/(PLAINTEXT|HMAC-SHA1)/)===undefined){throw"Unknown signing method specified for OAuthSimple.setSignatureMethod"}this._parameters["oauth_signature_method"]=a.toUpperCase();return this};this.sign=function(a){if(a===undefined){a={}}if(a["action"]!==undefined){this.setAction(a["action"])}if(a["path"]!==undefined){this.setPath(a["path"])}if(a["method"]!==undefined){this.setSignatureMethod(a["method"])}this.setTokensAndSecrets(a["signatures"]);if(a["parameters"]!==undefined){this.setParameters(a["parameters"])}var b=this._normalizedParameters();this._parameters["oauth_signature"]=this._generateSignature(b);return{parameters:this._parameters,signature:this._oauthEscape(this._parameters["oauth_signature"]),signed_url:this._path+"?"+this._normalizedParameters(),header:this.getHeaderString()}};this.getHeaderString=function(a){if(this._parameters["oauth_signature"]===undefined){this.sign(a)}var b="OAuth ";for(var c in this._parameters){if(!c.match(/^oauth/)){continue}if(this._parameters[c]instanceof Array){var d=this._parameters[c].length;for(var e=0;e<d;e++){b+=c+'="'+this._oauthEscape(this._parameters[c][e])+'" '}}else{b+=c+'="'+this._oauthEscape(this._parameters[c])+'" '}}return b};this._parseParameterString=function(a){var b=a.split("&");var c={};for(var d=b.shift();d;d=b.shift()){var e=d.split("=");var f="";if(e[1]){f=decodeURIComponent(e[1])}if(c[e[0]]){if(!(c[e[0]]instanceof Array)){c[e[0]]=Array(c[e[0]],f)}else{c[e[0]].push(f)}}else{c[e[0]]=f}}return c};this._oauthEscape=function(a){if(a===undefined){return""}if(a instanceof Array){throw"Array passed to _oauthEscape"}return encodeURIComponent(a).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")};this._getNonce=function(a){if(a===undefined){a=5}var b="";var c=this._nonce_chars.length;for(var d=0;d<a;d++){var e=Math.floor(Math.random()*c);b+=this._nonce_chars.substring(e,e+1)}this._parameters["oauth_nonce"]=b;return b};this._getApiKey=function(){if(this._secrets.consumer_key===undefined){throw"No consumer_key set for OAuthSimple."}this._parameters["oauth_consumer_key"]=this._secrets.consumer_key;return this._parameters.oauth_consumer_key};this._getAccessToken=function(){if(this._secrets["oauth_secret"]===undefined){return""}if(this._secrets["oauth_token"]===undefined){throw"No oauth_token (access_token) set for OAuthSimple."}this._parameters["oauth_token"]=this._secrets.oauth_token;return this._parameters.oauth_token};this._getTimestamp=function(){var a=new Date;var b=Math.floor(a.getTime()/1e3);this._parameters["oauth_timestamp"]=b;return b};this.b64_hmac_sha1=function(a,b,c,d){function m(a,b){return l(k(a,b))}function l(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="";for(var e=0;e<a.length*4;e+=3){var f=(a[e>>2]>>8*(3-e%4)&255)<<16|(a[e+1>>2]>>8*(3-(e+1)%4)&255)<<8|a[e+2>>2]>>8*(3-(e+2)%4)&255;for(var g=0;g<4;g++){if(e*8+g*6>a.length*32){d+=c}else{d+=b.charAt(f>>6*(3-g)&63)}}}return d}function k(a,b){var c=j(a);if(c.length>16){c=i(c,a.length*d)}var e=[16],f=[16];for(var g=0;g<16;g++){e[g]=c[g]^909522486;f[g]=c[g]^1549556828}var h=i(e.concat(j(b)),512+b.length*d);return i(f.concat(h),512+160)}function j(a){var b=[],c=(1<<d)-1;for(var e=0;e<a.length*d;e+=d){b[e>>5]|=(a.charCodeAt(e/8)&c)<<32-d-e%32}return b}function i(a,b){a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;var c=[80],d=1732584193,i=-271733879,j=-1732584194,k=271733878,l=-1009589776;for(var m=0;m<a.length;m+=16){var n=d,o=i,p=j,q=k,r=l;for(var s=0;s<80;s++){if(s<16){c[s]=a[m+s]}else{c[s]=h(c[s-3]^c[s-8]^c[s-14]^c[s-16],1)}var t=g(g(h(d,5),e(s,i,j,k)),g(g(l,c[s]),f(s)));l=k;k=j;j=h(i,30);i=d;d=t}d=g(d,n);i=g(i,o);j=g(j,p);k=g(k,q);l=g(l,r)}return[d,i,j,k,l]}function h(a,b){return a<<b|a>>>32-b}function g(a,b){var c=(a&65535)+(b&65535),d=(a>>16)+(b>>16)+(c>>16);return d<<16|c&65535}function f(a){return a<20?1518500249:a<40?1859775393:a<60?-1894007588:-899497514}function e(a,b,c,d){if(a<20){return b&c|~b&d}if(a<40){return b^c^d}if(a<60){return b&c|b&d|c&d}return b^c^d}if(!c){c="="}if(!d){d=8}return m(a,b)};this._normalizedParameters=function(){var a=new Array;var b=[];var c=0;for(var d in this._parameters){if(c++>1e3){throw"runaway 1"}b.unshift(d)}b=b.sort();pLen=b.length;for(var e=0;e<pLen;e++){d=b[e];if(d.match(/\w+_secret/)){continue}if(this._parameters[d]instanceof Array){var f=this._parameters[d].sort();var g=f.length;for(var h=0;h<g;h++){if(c++>1e3){throw"runaway 1"}a.push(this._oauthEscape(d)+"="+this._oauthEscape(f[h]))}continue}a.push(this._oauthEscape(d)+"="+this._oauthEscape(this._parameters[d]))}return a.join("&")};this._generateSignature=function(){var a=this._oauthEscape(this._secrets.shared_secret)+"&"+this._oauthEscape(this._secrets.oauth_secret);if(this._parameters["oauth_signature_method"]=="PLAINTEXT"){return a}if(this._parameters["oauth_signature_method"]=="HMAC-SHA1"){var b=this._oauthEscape(this._action)+"&"+this._oauthEscape(this._path)+"&"+this._oauthEscape(this._normalizedParameters());return this.b64_hmac_sha1(a,b)}return null};return this}}