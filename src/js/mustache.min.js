var Mustache=function(){var n=function(){};n.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(a,b,c,d){if(!d){this.context=b;this.buffer=[]}if(!this.includes("",a)){if(d){return a}else{this.send(a);return}}a=this.render_pragmas(a);var e=this.render_section(a,b,c);if(d){return this.render_tags(e,b,c,d)}this.render_tags(e,b,c,d)},send:function(a){if(a!=""){this.buffer.push(a)}},render_pragmas:function(e){if(!this.includes("%",e)){return e}var f=this;var g=new RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag);return e.replace(g,function(a,b,c){if(!f.pragmas_implemented[b]){throw({message:"This implementation of mustache doesn't understand the '"+b+"' pragma"})}f.pragmas[b]={};if(c){var d=c.split("=");f.pragmas[b][d[0]]=d[1]}return""})},render_partial:function(a,b,c){a=this.trim(a);if(!c||c[a]===undefined){throw({message:"unknown_partial '"+a+"'"})}if(typeof(b[a])!="object"){return this.render(c[a],b,c,true)}return this.render(c[a],b[a],c,true)},render_section:function(g,h,i){if(!this.includes("#",g)&&!this.includes("^",g)){return g}var j=this;var k=new RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg");return g.replace(k,function(b,c,d,e){var f=j.find(d,h);if(c=="^"){if(!f||j.is_array(f)&&f.length===0){return j.render(e,h,i,true)}else{return""}}else if(c=="#"){if(j.is_array(f)){return j.map(f,function(a){return j.render(e,j.create_context(a),i,true)}).join("")}else if(j.is_object(f)){return j.render(e,j.create_context(f),i,true)}else if(typeof f==="function"){return f.call(h,e,function(a){return j.render(a,h,i,true)})}else if(f){return j.render(e,h,i,true)}else{return""}}})},render_tags:function(d,e,f,g){var h=this;var j=function(){return new RegExp(h.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+h.ctag+"+","g")};var k=j();var l=function(a,b,c){switch(b){case"!":return"";case"=":h.set_delimiters(c);k=j();return"";case">":return h.render_partial(c,e,f);case"{":return h.find(c,e);default:return h.escape(h.find(c,e))}};var m=d.split("\n");for(var i=0;i<m.length;i++){m[i]=m[i].replace(k,l,this);if(!g){this.send(m[i])}}if(g){return m.join("\n")}},set_delimiters:function(a){var b=a.split(" ");this.otag=this.escape_regex(b[0]);this.ctag=this.escape_regex(b[1])},escape_regex:function(a){if(!arguments.callee.sRE){var b=['/','.','*','+','?','|','(',')','[',']','{','}','\\'];arguments.callee.sRE=new RegExp('(\\'+b.join('|\\')+')','g')}return a.replace(arguments.callee.sRE,'\\$1')},find:function(b,c){b=this.trim(b);function is_kinda_truthy(a){return a===false||a===0||a}var d;if(is_kinda_truthy(c[b])){d=c[b]}else if(is_kinda_truthy(this.context[b])){d=this.context[b]}if(typeof d==="function"){return d.apply(c)}if(d!==undefined){return d}return""},includes:function(a,b){return b.indexOf(this.otag+a)!=-1},escape:function(s){s=String(s===null?"":s);return s.replace(/&(?!\w+;)|["<>\\]/g,function(s){switch(s){case"&":return"&amp;";case"\\":return"\\\\";case'"':return'\"';case"<":return"&lt;";case">":return"&gt;";default:return s}})},create_context:function(a){if(this.is_object(a)){return a}else{var b=".";if(this.pragmas["IMPLICIT-ITERATOR"]){b=this.pragmas["IMPLICIT-ITERATOR"].iterator}var c={};c[b]=a;return c}},is_object:function(a){return a&&typeof a=="object"},is_array:function(a){return Object.prototype.toString.call(a)==='[object Array]'},trim:function(s){return s.replace(/^\s*|\s*$/g,"")},map:function(a,b){if(typeof a.map=="function"){return a.map(b)}else{var r=[];var l=a.length;for(var i=0;i<l;i++){r.push(b(a[i]))}return r}}};return({name:"mustache.js",version:"0.3.0",to_html:function(a,b,c,d){var e=new n();if(d){e.send=d}e.render(a,b,c);if(!d){return e.buffer.join("\n")}}})}();